<!doctype html><html lang=en>
<head>
<meta charset=utf-8>
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=description content="Personal blog on cybersecurity, harware hacking and security research.">
<title> CVE-2022-44900: path traversal vulnerability in py7zr | less on sec </title>
<link rel=stylesheet href=/css/reset.css>
<link rel=stylesheet href=/css/font.css>
<link rel=stylesheet href=/css/smigle.css>
<link rel=stylesheet href=/css/custom.css>
<link rel=canonical href=https://lessonsec.com/cve/cve-2022-44900/>
<link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png>
<link rel=manifest href=/site.webmanifest>
<link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5>
<meta name=msapplication-TileColor content="#da532c">
<meta name=theme-color content="#ffffff"><meta name=og:title content="CVE-2022-44900: path traversal vulnerability in py7zr">
<meta name=twitter:title content="CVE-2022-44900: path traversal vulnerability in py7zr">
<meta property="og:url" content="https://lessonsec.com/cve/cve-2022-44900/">
<meta property="og:description" content><meta name=og:image/ content>
<meta name=twitter:image content></head>
<body>
<header>
<div id=brand>
<a class=icon-link href=https://lessonsec.com>
<img class=icon src=/images/logo_white.svg>
</a>
<div class=text>
<a href=https://lessonsec.com><h1>less on sec</h1></a>
<h3>exploring, hacking and breaking stuff</h3>
</div>
</div>
<nav>
<div class=responsive_div_top>
<a href=/><b>Home</b></a>
|
<a href=/whoami/><b>Whoami</b></a>
|
<a href=/posts/><b>Posts</b></a>
|
<a href=/cve/><b>CVE</b></a>
</div>
<div class=responsive_div_bottom>
Links:
<a href=https://github.com/0xless>GitHub</a>
|
<a href=https://www.linkedin.com/in/matteo-cosentino/>Linkedin</a>
|
<a href=mailto:contact@lessonsec.com>Email</a>
</div>
</nav>
<hr>
</header>
<div id=content>
<main>
<article>
<h1>CVE-2022-44900: path traversal vulnerability in py7zr</h1>
<div class=post-meta>
<strong>
<span>Posted on</span>
<time>2022-12-06</time>
</strong>
<span> • 268 words</span>
</div>
<div><p>Directory traversal vulnerability in SevenZipFile.extractall() function of the python library py7zr version 0.20.0 and earlier allow attackers to read arbitrary files on the local machine via malicious 7z file extraction.</p>
<p><a href="https://www.cve.org/CVERecord?id=CVE-2022-44900">CVE-2022-44900</a> vulnerability allows attackers to achieve arbitrary file read and arbitrary file write. To do so, an attacker needs to create a malicious 7z archive containing a symlink to achieve an arbitrary file read and a file with a path traversal payload as name to achieve an arbitrary file write.</p>
<h2 id=exploiting>Exploiting</h2>
<p>The script used for tests is the following:</p>
<pre tabindex=0><code>import py7zr
import click

@click.command()
@click.argument(&quot;filename&quot;)

def main_procedure(filename):
	with py7zr.SevenZipFile(filename, 'r') as archive:
	    archive.extractall()
	
main_procedure()
</code></pre><p>The vulnerabile function targeted is py7zr.SevenZipFile.extractall().</p>
<p>A lab setup has been built to test for vulnerabilities.
Directories structured as follow were used:</p>
<pre tabindex=0><code>├── start_point
│   ├── archive.7z
│   └── py7zr_test.py
└── target
    ├── write
    └── read
</code></pre><p>The <code>start_point</code> directory contains the script used for tests and the malicious archive containing the path traversal payload in the form of the filename of an archived file.</p>
<p>To achieve an arbitrary file read, one of the files in the archives needs to have <code>../target/write</code> set as name. The content of the file will be written into <code>target/write</code>.</p>
<p>In a similar way, to achieve an arbitrary file read, a symlink pointing to <code>../target/read</code> needs to be present in the archive. When extracted the symlink will consist of the content of <code>target/read</code>.</p>
<h2 id=disclosure-timeline>Disclosure timeline</h2>
<p>29/10/2022 - Maintainer was notified privately of the vulnerabilities<br>
30/10/2022 - Response from maintainer<br>
01/11/2022 - Release of patched version 0.20.1<br>
01/11/2022 - CVE ID request<br>
06/12/2022 - CVE ID obtained<br>
06/12/2022 - Public disclosure</p>
</div>
</article>
</main>
</div>
<footer>
<hr>
<p class=copyright>
Copyright © 2022
<a href=https://lessonsec.com><strong>Matteo [0xless] Cosentino</strong></a>.
</footer>
<script data-goatcounter=https://lessonsec.goatcounter.com/count async src=https://lessonsec.com/script/count.js></script>
</body>
</html>